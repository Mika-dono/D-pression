<div class="shop-page">
  <!-- Page Hero -->
  <section class="page-hero">
    <div class="hero-bg">
      <div class="hero-gradient"></div>
      <div class="hero-grid"></div>
      <div class="hero-glow"></div>
    </div>
    <div class="hero-container">
      <div class="hero-content">
        <div class="page-badge">
          <span class="badge-icon">üõçÔ∏è</span>
          <span class="badge-text">BOUTIQUE OFFICIELLE</span>
        </div>
        <h1 class="page-title">
          <span class="title-line">√âquipez-vous</span>
          <span class="title-line accent">Comme un Pro</span>
        </h1>
        <p class="page-subtitle">
          D√©couvrez la collection officielle Kyojin KJX E-sports. Maillots, √©quipements gaming 
          et accessoires exclusifs port√©s par nos joueurs professionnels.
        </p>
        <div class="hero-actions">
          <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input 
              type="text" 
              [(ngModel)]="searchQuery"
              (input)="onSearch()"
              placeholder="Rechercher un produit..."
              class="search-input"
            />
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Products -->
  <section class="featured-section" *ngIf="featuredProducts.length > 0">
    <div class="section-container">
      <div class="section-header">
        <span class="section-badge">‚≠ê S√âLECTION</span>
        <h2 class="section-title">Produits <span class="accent">Populaires</span></h2>
      </div>
      <div class="featured-grid">
        <div 
          *ngFor="let product of featuredProducts; let i = index" 
          class="featured-card animate-on-scroll"
          [style.animationDelay]="i * 0.1 + 's'"
          (click)="openQuickView(product)"
        >
          <div class="featured-image">
            <div class="product-placeholder">
              <span>{{ getCategoryIcon(product.category) }}</span>
            </div>
            <div class="featured-badge" *ngIf="product.badge">{{ product.badge }}</div>
            <div class="featured-overlay">
              <button class="btn-quick-view">Aper√ßu rapide</button>
            </div>
          </div>
          <div class="featured-info">
            <span class="product-category">{{ getCategoryIcon(product.category) }} {{ product.category | titlecase }}</span>
            <h3 class="product-name">{{ product.name }}</h3>
            <div class="product-rating" *ngIf="product.rating">
              <span class="stars">
                <span *ngFor="let star of renderStars(product.rating)" [class.filled]="star === '‚òÖ'">{{ star }}</span>
              </span>
              <span class="reviews">({{ product.reviews }})</span>
            </div>
            <div class="product-price">
              <span class="price-current">{{ product.price }} ‚Ç¨</span>
              <span class="price-original" *ngIf="product.originalPrice">{{ product.originalPrice }} ‚Ç¨</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Shop -->
  <section class="main-shop">
    <div class="section-container">
      <!-- Shop Header -->
      <div class="shop-header">
        <div class="shop-filters">
          <div class="filter-tabs">
            <button 
              *ngFor="let cat of categories"
              (click)="applyFilter(cat.id)"
              [class.active]="selectedFilter === cat.id"
              class="filter-tab"
            >
              <span class="tab-icon">{{ cat.icon }}</span>
              <span class="tab-name">{{ cat.name }}</span>
            </button>
          </div>
        </div>
        <div class="shop-actions">
          <div class="sort-wrapper">
            <select [(ngModel)]="sortBy" (change)="onSortChange()" class="sort-select">
              <option value="featured">Populaires</option>
              <option value="newest">Nouveaut√©s</option>
              <option value="price-asc">Prix croissant</option>
              <option value="price-desc">Prix d√©croissant</option>
              <option value="rating">Mieux not√©s</option>
            </select>
          </div>
          <button class="cart-btn" (click)="toggleCart()">
            <span class="cart-icon">üõí</span>
            <span class="cart-text">Panier</span>
            <span class="cart-badge" *ngIf="getCartCount() > 0">{{ getCartCount() }}</span>
          </button>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="products-grid" #productsGrid>
        <div 
          *ngFor="let product of filteredProducts; let i = index" 
          class="product-card"
          [style.animationDelay]="i * 0.05 + 's'"
        >
          <div class="card-image" (click)="openQuickView(product)">
            <div class="product-placeholder">
              <span>{{ getCategoryIcon(product.category) }}</span>
            </div>
            <div class="product-badges">
              <span class="badge badge-sale" *ngIf="product.originalPrice">-{{ getDiscountPercent(product) }}%</span>
              <span class="badge badge-new" *ngIf="product.badge === 'NOUVEAU'">NEW</span>
              <span class="badge badge-limited" *ngIf="product.badge === 'LIMIT√â' || product.badge === 'EXCLUSIF'">{{ product.badge }}</span>
            </div>
            <div class="card-overlay">
              <button class="btn-icon btn-view">üëÅÔ∏è</button>
              <button class="btn-icon btn-wishlist">‚ù§Ô∏è</button>
            </div>
          </div>
          <div class="card-content">
            <span class="product-category-tag">{{ product.category | titlecase }}</span>
            <h3 class="product-title">{{ product.name }}</h3>
            <p class="product-desc">{{ product.description }}</p>
            <div class="product-meta">
              <div class="product-rating" *ngIf="product.rating">
                <span class="stars">
                  <span *ngFor="let star of renderStars(product.rating)" class="star" [class.filled]="star === '‚òÖ'">{{ star }}</span>
                </span>
                <span class="rating-count">({{ product.reviews }})</span>
              </div>
              <span class="stock-status" [class.low]="product.stock < 10">
                {{ product.stock > 0 ? (product.stock < 10 ? 'Stock limit√©' : 'En stock') : 'Rupture' }}
              </span>
            </div>
            <div class="card-footer">
              <div class="price-block">
                <span class="price-main">{{ product.price }} ‚Ç¨</span>
                <span class="price-old" *ngIf="product.originalPrice">{{ product.originalPrice }} ‚Ç¨</span>
              </div>
              <button 
                class="btn-add-cart"
                (click)="addToCart(product); $event.stopPropagation()"
                [disabled]="product.stock === 0"
              >
                <span class="btn-icon">üõí</span>
                <span class="btn-text">{{ product.stock === 0 ? 'Rupture' : 'Ajouter' }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredProducts.length === 0">
        <div class="empty-icon">üîç</div>
        <h3 class="empty-title">Aucun produit trouv√©</h3>
        <p class="empty-text">Essayez de modifier vos filtres ou votre recherche</p>
        <button class="btn-reset" (click)="searchQuery = ''; applyFilter('all')">R√©initialiser</button>
      </div>
    </div>
  </section>

  <!-- Shop Features -->
  <section class="shop-features">
    <div class="section-container">
      <div class="features-grid">
        <div class="feature-item">
          <div class="feature-icon">üöö</div>
          <div class="feature-content">
            <h4 class="feature-title">Livraison Offerte</h4>
            <p class="feature-text">√Ä partir de 50‚Ç¨ d'achat</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üîÑ</div>
          <div class="feature-content">
            <h4 class="feature-title">Retours Gratuits</h4>
            <p class="feature-text">Sous 30 jours</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üîí</div>
          <div class="feature-content">
            <h4 class="feature-title">Paiement S√©curis√©</h4>
            <p class="feature-text">Stripe & PayPal</p>
          </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">üéÅ</div>
          <div class="feature-content">
            <h4 class="feature-title">-20% Membres</h4>
            <p class="feature-text">Sur tout le catalogue</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Cart Sidebar -->
  <div class="cart-overlay" [class.active]="showCart" (click)="toggleCart()"></div>
  <aside class="cart-sidebar" [class.active]="showCart">
    <div class="cart-header">
      <h3 class="cart-title">
        <span class="cart-title-icon">üõí</span>
        Votre Panier
        <span class="cart-count">({{ getCartCount() }})</span>
      </h3>
      <button class="btn-close-cart" (click)="toggleCart()">‚úï</button>
    </div>

    <div class="cart-empty" *ngIf="cart.length === 0">
      <div class="empty-cart-icon">üõí</div>
      <p class="empty-cart-text">Votre panier est vide</p>
      <button class="btn-shop" (click)="toggleCart()">Continuer vos achats</button>
    </div>

    <div class="cart-items" *ngIf="cart.length > 0">
      <div class="cart-item" *ngFor="let item of cart">
        <div class="item-image">
          <div class="item-placeholder">{{ getCategoryIcon(item.category) }}</div>
        </div>
        <div class="item-details">
          <h4 class="item-name">{{ item.name }}</h4>
          <p class="item-price">{{ item.price }} ‚Ç¨</p>
          <div class="item-quantity">
            <button class="qty-btn" (click)="updateQuantity(item.id, item.quantity - 1)">‚àí</button>
            <span class="qty-value">{{ item.quantity }}</span>
            <button class="qty-btn" (click)="updateQuantity(item.id, item.quantity + 1)">+</button>
          </div>
        </div>
        <div class="item-total">
          <span class="total-price">{{ (item.price * item.quantity).toFixed(2) }} ‚Ç¨</span>
          <button class="btn-remove" (click)="removeFromCart(item.id)">üóëÔ∏è</button>
        </div>
      </div>
    </div>

    <div class="cart-footer" *ngIf="cart.length > 0">
      <div class="cart-subtotal">
        <span class="subtotal-label">Sous-total</span>
        <span class="subtotal-value">{{ getCartTotal().toFixed(2) }} ‚Ç¨</span>
      </div>
      <div class="cart-shipping">
        <span class="shipping-label">Livraison</span>
        <span class="shipping-value">{{ getCartTotal() >= 50 ? 'Gratuite' : '4.99 ‚Ç¨' }}</span>
      </div>
      <div class="cart-total">
        <span class="total-label">Total</span>
        <span class="total-value">{{ (getCartTotal() + (getCartTotal() >= 50 ? 0 : 4.99)).toFixed(2) }} ‚Ç¨</span>
      </div>
      <button class="btn-checkout" (click)="openPaymentModal()">
        <span>Proc√©der au paiement</span>
        <span class="checkout-arrow">‚Üí</span>
      </button>
      <button class="btn-clear-cart" (click)="clearCart()">Vider le panier</button>
    </div>
  </aside>

  <!-- Quick View Modal -->
  <div class="quickview-overlay" [class.active]="showQuickView" (click)="closeQuickView()"></div>
  <div class="quickview-modal" [class.active]="showQuickView" *ngIf="quickViewProduct">
    <button class="btn-close-modal" (click)="closeQuickView()">‚úï</button>
    <div class="quickview-content">
      <div class="quickview-image">
        <div class="product-placeholder large">
          <span>{{ getCategoryIcon(quickViewProduct.category) }}</span>
        </div>
        <div class="quickview-badges">
          <span class="badge" *ngIf="quickViewProduct.badge">{{ quickViewProduct.badge }}</span>
        </div>
      </div>
      <div class="quickview-info">
        <span class="quickview-category">{{ quickViewProduct.category | titlecase }}</span>
        <h2 class="quickview-title">{{ quickViewProduct.name }}</h2>
        <div class="quickview-rating" *ngIf="quickViewProduct.rating">
          <span class="stars">
            <span *ngFor="let star of renderStars(quickViewProduct.rating)" [class.filled]="star === '‚òÖ'">{{ star }}</span>
          </span>
          <span class="reviews">{{ quickViewProduct.reviews }} avis</span>
        </div>
        <p class="quickview-desc">{{ quickViewProduct.description }}</p>
        <div class="quickview-price">
          <span class="price-main">{{ quickViewProduct.price }} ‚Ç¨</span>
          <span class="price-old" *ngIf="quickViewProduct.originalPrice">{{ quickViewProduct.originalPrice }} ‚Ç¨</span>
          <span class="price-save" *ngIf="quickViewProduct.originalPrice">
            √âconomisez {{ (quickViewProduct.originalPrice - quickViewProduct.price).toFixed(2) }} ‚Ç¨
          </span>
        </div>
        <div class="quickview-options" *ngIf="quickViewProduct.sizes">
          <label class="option-label">Taille</label>
          <div class="size-options">
            <button *ngFor="let size of quickViewProduct.sizes" class="size-btn">{{ size }}</button>
          </div>
        </div>
        <div class="quickview-stock">
          <span class="stock-indicator" [class.low]="quickViewProduct.stock < 10"></span>
          {{ quickViewProduct.stock }} en stock
        </div>
        <div class="quickview-actions">
          <button class="btn-add-cart-large" (click)="addToCart(quickViewProduct); closeQuickView()">
            <span class="btn-icon">üõí</span>
            Ajouter au panier
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-notification" [class.show]="showNotificationToast">
    <span class="toast-icon">‚úì</span>
    <span class="toast-message">{{ notificationMessage }}</span>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal-overlay" *ngIf="showPaymentModal" (click)="closePaymentModal()">
    <div class="payment-modal" (click)="$event.stopPropagation()">
      <!-- Header -->
      <div class="modal-header">
        <div>
          <h2 class="modal-title">Finaliser la commande</h2>
          <p class="modal-subtitle">Total: {{ (getCartTotal() + (getCartTotal() >= 50 ? 0 : 4.99)).toFixed(2) }} ‚Ç¨</p>
        </div>
        <button class="modal-close" (click)="closePaymentModal()">
          <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Payment Method Selection -->
      <div class="modal-content" *ngIf="paymentStep === 'select'">
        <p class="method-instruction">Choisissez votre mode de paiement</p>
        <div class="payment-methods-grid">
          <button class="payment-method-btn card" (click)="selectPaymentMethod('card')">
            <span class="method-icon">üí≥</span>
            <div class="method-info">
              <span class="method-name">Carte bancaire</span>
              <span class="method-desc">Visa, Mastercard, Amex</span>
            </div>
            <span class="method-arrow">‚Üí</span>
          </button>
          <button class="payment-method-btn paypal" (click)="selectPaymentMethod('paypal')">
            <span class="method-icon">üÖøÔ∏è</span>
            <div class="method-info">
              <span class="method-name">PayPal</span>
              <span class="method-desc">Paiement s√©curis√© PayPal</span>
            </div>
            <span class="method-arrow">‚Üí</span>
          </button>
          <button class="payment-method-btn stripe" (click)="selectPaymentMethod('stripe')">
            <span class="method-icon">‚ö°</span>
            <div class="method-info">
              <span class="method-name">Stripe</span>
              <span class="method-desc">Paiement express s√©curis√©</span>
            </div>
            <span class="method-arrow">‚Üí</span>
          </button>
          <button class="payment-method-btn wise" (click)="selectPaymentMethod('wise')">
            <span class="method-icon">üåç</span>
            <div class="method-info">
              <span class="method-name">Wise</span>
              <span class="method-desc">Transfert international</span>
            </div>
            <span class="method-arrow">‚Üí</span>
          </button>
        </div>
        <div class="secure-notice">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
          </svg>
          <span>Paiement 100% s√©curis√© - Donn√©es chiffr√©es SSL</span>
        </div>
      </div>

      <!-- Card Payment Form -->
      <div class="modal-content" *ngIf="paymentStep === 'card'">
        <button class="back-btn" (click)="goBackToMethods()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Retour
        </button>        <div class="test-card-info">
          <span class="test-badge">üß™ TEST</span>
          <span>Carte: 4242 4242 4242 4242 | Exp: 12/28 | CVV: 123</span>
        </div>        <form class="card-form" (ngSubmit)="processCardPayment()">
          <div class="form-group">
            <label class="form-label">Num√©ro de carte</label>
            <div class="card-input-wrapper">
              <input type="text" class="form-input card-number-input" 
                     [class.error]="cardErrors.cardNumber"
                     [value]="cardForm.cardNumber"
                     (input)="onCardNumberInput($event)"
                     placeholder="1234 5678 9012 3456" maxlength="19"/>
              <span class="card-brand-badge" *ngIf="detectedCardBrand">{{ detectedCardBrand | uppercase }}</span>
            </div>
            <span class="error-text" *ngIf="cardErrors.cardNumber">{{ cardErrors.cardNumber }}</span>
          </div>
          <div class="form-group">
            <label class="form-label">Nom sur la carte</label>
            <input type="text" class="form-input" [(ngModel)]="cardForm.cardName" 
                   name="cardName" placeholder="JEAN DUPONT"/>
          </div>
          <div class="form-row">
            <div class="form-group half">
              <label class="form-label">Expiration</label>
              <input type="text" class="form-input" 
                     [class.error]="cardErrors.expiryDate"
                     [value]="cardForm.expiryDate"
                     (input)="onExpiryInput($event)"
                     placeholder="MM/YY" maxlength="5"/>
              <span class="error-text" *ngIf="cardErrors.expiryDate">{{ cardErrors.expiryDate }}</span>
            </div>
            <div class="form-group half">
              <label class="form-label">CVV</label>
              <input type="text" class="form-input" 
                     [class.error]="cardErrors.cvv"
                     [value]="cardForm.cvv"
                     (input)="onCvvInput($event)"
                     placeholder="123" [attr.maxlength]="detectedCardBrand === 'amex' ? 4 : 3"/>
              <span class="error-text" *ngIf="cardErrors.cvv">{{ cardErrors.cvv }}</span>
            </div>
          </div>
          <div class="form-divider"><span>Informations de contact</span></div>
          <div class="form-group">
            <label class="form-label">Email de confirmation</label>
            <input type="email" class="form-input" [(ngModel)]="cardForm.email" 
                   name="email" placeholder="votre@email.com"/>
          </div>
          <button type="submit" class="btn-pay">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            Payer {{ (getCartTotal() + (getCartTotal() >= 50 ? 0 : 4.99)).toFixed(2) }} ‚Ç¨
          </button>
        </form>
      </div>

      <!-- PayPal -->
      <div class="modal-content" *ngIf="paymentStep === 'paypal'">
        <button class="back-btn" (click)="goBackToMethods()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Retour
        </button>
        <div class="paypal-section">
          <div class="paypal-logo">üÖøÔ∏è PayPal</div>
          <p class="paypal-info">Vous serez redirig√© vers PayPal pour finaliser le paiement en toute s√©curit√©.</p>
          <div id="paypal-button-container-shop" class="paypal-button-container"></div>
        </div>
      </div>

      <!-- Stripe -->
      <div class="modal-content" *ngIf="paymentStep === 'stripe'">
        <button class="back-btn" (click)="goBackToMethods()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Retour
        </button>
        <div class="stripe-section">
          <div class="stripe-logo">‚ö° Stripe</div>
          <div id="stripe-card-element-shop" class="stripe-element"></div>
          <button class="btn-pay stripe-btn" (click)="processStripePayment()">
            Payer {{ (getCartTotal() + (getCartTotal() >= 50 ? 0 : 4.99)).toFixed(2) }} ‚Ç¨ avec Stripe
          </button>
        </div>
      </div>

      <!-- Wise -->
      <div class="modal-content" *ngIf="paymentStep === 'wise'">
        <button class="back-btn" (click)="goBackToMethods()">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          Retour
        </button>
        <div class="wise-section">
          <div class="wise-logo">üåç Wise</div>
          <p class="wise-info">Transfert international avec les meilleurs taux de change.</p>
          <div class="form-group">
            <label class="form-label">Votre email</label>
            <input type="email" class="form-input" [(ngModel)]="wiseEmail" placeholder="votre@email.com"/>
          </div>
          <button class="btn-pay wise-btn" (click)="processWisePayment()" [disabled]="!wiseEmail">
            Cr√©er le transfert de {{ (getCartTotal() + (getCartTotal() >= 50 ? 0 : 4.99)).toFixed(2) }} ‚Ç¨
          </button>
        </div>
      </div>

      <!-- Processing -->
      <div class="modal-content processing" *ngIf="paymentStep === 'processing'">
        <div class="processing-animation">
          <div class="spinner"></div>
        </div>
        <h3 class="processing-title">Traitement en cours...</h3>
        <p class="processing-text">Veuillez patienter, ne fermez pas cette fen√™tre.</p>
      </div>

      <!-- Success -->
      <div class="modal-content success" *ngIf="paymentStep === 'success'">
        <div class="success-icon">‚úÖ</div>
        <h3 class="success-title">Paiement r√©ussi !</h3>
        <p class="success-text">Merci pour votre commande chez Kyojin KJX E-sports.<br/>Un email de confirmation vous a √©t√© envoy√©.</p>
        <div class="transaction-info">
          <span class="transaction-label">Transaction</span>
          <span class="transaction-value">{{ transactionId }}</span>
        </div>
        <button class="btn-primary" (click)="closePaymentModal()">Fermer</button>
      </div>

      <!-- Error -->
      <div class="modal-content error" *ngIf="paymentStep === 'error'">
        <div class="error-icon">‚ùå</div>
        <h3 class="error-title">√âchec du paiement</h3>
        <p class="error-text">{{ paymentError }}</p>
        <div class="error-actions">
          <button class="btn-secondary" (click)="closePaymentModal()">Annuler</button>
          <button class="btn-primary" (click)="retryPayment()">R√©essayer</button>
        </div>
      </div>
    </div>
  </div>
</div>

